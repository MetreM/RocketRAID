--- rr2340-linux-src-v1.7.orig/osm/linux/os_linux.c	2016-12-12 21:09:26.627209888 +0100
+++ rr2340-linux-src-v1.7/osm/linux/os_linux.c		2016-12-12 21:10:02.867210673 +0100
@@ -275,18 +275,18 @@
 						blkdev_get(bdev, FMODE_READ, 0 __BDEV_RAW)
 #endif
 						==0) {
-						if (bdev->bd_disk && bdev->bd_disk->driverfs_dev==&SDptr->sdev_gendev) {
+						if (bdev->bd_disk && bdev->bd_disk==&SDptr->sdev_gendev) {
 							if (vbus_ext->sd_flags[id] & SD_FLAG_REVALIDATE) {
 								if (bdev->bd_disk->fops->revalidate_disk)
 									bdev->bd_disk->fops->revalidate_disk(bdev->bd_disk);
 #if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,15)
-								mutex_lock(&bdev->bd_inode->i_mutex);
+								inode_lock(bdev->bd_inode);
 #else 
 								down(&bdev->bd_inode->i_sem);
 #endif
 								i_size_write(bdev->bd_inode, (loff_t)get_capacity(bdev->bd_disk)<<9);
 #if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,15)
-								mutex_unlock(&bdev->bd_inode->i_mutex);
+								inode_unlock(bdev->bd_inode);
 #else 
 								up(&bdev->bd_inode->i_sem);
 #endif
schleppi linux # 

